function audioReceived(filename, filedata) {
  filedata = window.atob(filedata);
  var container = document.getElementById('audio_container');
  var wrap = document.getElementById('recorder-wrap');
  var link = document.createElement('a');
  var audio = document.createElement('audio');
  var WU = window.URL || window.webkitURL;
  var blob, recorderHTML;

  // Extract raw data from Base64-encoded string
  var ar = new Uint8Array(filedata.length);
  for(var i=0;i<filedata.length;++i) {
    ar[i] = filedata.charCodeAt(i);
  }

  // Put audio data into a blob and set up <audio> tag
  blob = new Blob([ar], {type:'audio/x-wav'});
  audio.src = WU.createObjectURL(blob);

  var formElement = document.getElementById('exercise_form')
  var formData = new FormData(formElement);
  formData.append('audio_file', blob);

  var request = new XMLHttpRequest();
  request.open("PATCH", "/exercises/store_record");
  request.send(formData);
}

flashvars = {
  gateway:'form',
  filename: 'not_change',
  'return':'reset',
  callback:'audioReceived',
  format: 'wav'
};
swfobject.embedSWF("<%= asset_path 'local_audio_recorder/recorder.swf' %>", "recorder", "215", "138", "10.1", "<%= asset_path 'local_audio_recorder/expressInstall.swf' %>", flashvars);
